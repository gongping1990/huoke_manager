"use strict";!function(t){var a=t.fabric||(t.fabric={}),e="1.6.0",h=a.util.degreesToRadians,i={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7};-1<e.localeCompare(t.fabric.version)&&console.warn("this extension might not be fully compatible with your version of fabric.js ("+t.fabric.version+").Consider using the latest compatible build of fabric.js (> "+e+")"),a.util.object.extend(a.Object.prototype,{useCustomIcons:!1,cornerBackgroundColor:"transparent",cornerShape:"",cornerPadding:0,customiseCornerIcons:function(t,e){var r,i;for(r in t)t.hasOwnProperty(r)&&(i={},void 0!==t[r].cornerShape&&(this.cornerShape=t[r].cornerShape),void 0!==t[r].cornerBackgroundColor&&(this.cornerBackgroundColor=t[r].cornerBackgroundColor),void 0!==t[r].borderColor&&(this.borderColor=t[r].borderColor),void 0!==t[r].cornerSize&&(this.cornerSize=t[r].cornerSize),void 0!==t[r].cornerPadding&&(this.cornerPadding=t[r].cornerPadding),void 0===t[r].icon&&"settings"!==Object.keys(t)[0]||(this.useCustomIcons=!0,void 0!==t[r].settings&&(i.settings=t[r].settings),void 0!==t[r].icon&&(i.icon=t[r].icon,this.loadIcon(r,i,function(){e&&"function"==typeof e&&e()}))))},loadIcon:function(t,e,r){var i=this,o=new Image;o.onload=function(){i[t+"Icon"]=this,e.settings&&(i[t+"Settings"]=e.settings),r&&"function"==typeof r&&r()},o.onerror=function(){a.warn(this.src+" icon is not an image")},(e.icon.match(/^http[s]?:\/\//)||"//"===e.icon.substring(0,2))&&(o.crossOrigin="Anonymous"),o.src=e.icon},customizeCornerIcons:function(t){this.customiseCornerIcons(t)},drawControls:function(t){if(!this.hasControls)return this;var e,r=this._calculateCurrentDimensions(),i=r.x,o=r.y,s=this.cornerSize,n=-(i+s)/2,c=-(o+s)/2;return this.useCustomIcons?e="drawImage":(t.lineWidth=1,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=t.fillStyle=this.cornerColor,this.transparentCorners||(t.strokeStyle=this.cornerStrokeColor),e=this.transparentCorners?"stroke":"fill"),t.save(),this._setLineDash(t,this.cornerDashArray,null),this._drawControl("tl",t,e,n,c,this.tlIcon,this.tlSettings),this._drawControl("tr",t,e,n+i,c,this.trIcon,this.trSettings),this._drawControl("bl",t,e,n,c+o,this.blIcon,this.blSettings),this._drawControl("br",t,e,n+i,c+o,this.brIcon,this.brSettings),this.get("lockUniScaling")||(this._drawControl("mt",t,e,n+i/2,c,this.mtIcon,this.mtSettings),this._drawControl("mb",t,e,n+i/2,c+o,this.mbIcon,this.mbSettings),this._drawControl("mr",t,e,n+i,c+o/2,this.mrIcon,this.mrSettings),this._drawControl("ml",t,e,n,c+o/2,this.mlIcon,this.mlSettings)),this.hasRotatingPoint&&this._drawControl("mtr",t,e,n+i/2,c-this.rotatingPointOffset,this.mtrIcon,this.mtrSettings),t.restore(),this},_drawControl:function(t,e,r,i,o,s,n){if(this.isControlVisible(t)){var c=this.cornerSize,a=this.cornerStrokeColor||"transparent",h=this.cornerBackgroundColor||"black",l=this.cornerShape||"rect",u="number"==typeof this.cornerPadding?this.cornerPadding:10;if(n&&(n.cornerSize&&(i=i+c/2-n.cornerSize/2,o=o+c/2-n.cornerSize/2,c=n.cornerSize),l=n.cornerShape||l,h=n.cornerBackgroundColor||h,u="number"==typeof n.cornerPadding?n.cornerPadding:u,a=n.cornerStrokeColor||a),this.useCustomIcons)if(l){switch(e.globalAlpha=1,e.fillStyle=h,e.lineWidth=1,e.strokeStyle=a,l){case"rect":e.fillRect(i,o,c,c),a&&e.strokeRect(i,o,c,c);break;case"circle":e.beginPath(),e.arc(i+c/2,o+c/2,c/2,0,2*Math.PI),e.fill(),a&&e.stroke(),e.closePath()}void 0!==s&&e[r](s,i+u/2,o+u/2,c-u,c-u)}else void 0!==s&&e[r](s,i,o,c,c);else"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(i,o,c,c),e[r+"Rect"](i,o,c,c),!this.transparentCorners&&a&&e.strokeRect(i,o,c,c)}},_setCornerCoords:function(){var t=this.oCoords,e=h(45-this.angle);for(var r in t){var i,o,s=.707106*(this[r+"Settings"]&&this[r+"Settings"].cornerSize||this.cornerSize),n=s*a.util.cos(e),c=s*a.util.sin(e);i=t[r].x,o=t[r].y,t[r].corner={tl:{x:i-c,y:o-n},tr:{x:i+n,y:o-c},bl:{x:i-n,y:o+c},br:{x:i+c,y:o+n}}}}}),a.util.object.extend(a.Canvas.prototype,{overwriteActions:!1,fixedCursors:!1,customiseControls:function(t){var e;for(e in t)t.hasOwnProperty(e)&&(void 0!==t[e].action&&(this.overwriteActions=!0,this.setCustomAction(e,t[e].action)),void 0!==t[e].cursor&&(this.fixedCursors=!0,this.setCustomCursor(e,t[e].cursor)))},setCustomAction:function(t,e){this[t+"Action"]=e},setCustomCursor:function(t,e){this[t+"cursorIcon"]=e},customizeControls:function(t){this.customiseControls(t)},_getActionFromCorner:function(t,e,r){if(!e)return"drag";if(e)if(this[e+"Action"]&&this.overwriteActions)switch(e){case"mtr":return this[e+"Action"]||"rotate";case"ml":case"mr":return r[this.altActionKey]?r[this.altActionKey]?"skewY":"scaleX":this[e+"Action"];case"mt":case"mb":return r[this.altActionKey]?r[this.altActionKey]?"skewY":"scaleY":this[e+"Action"];default:return this[e+"Action"]||"scale"}else switch(e){case"mtr":return"rotate";case"ml":case"mr":return r[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return r[this.altActionKey]?"skewX":"scaleY";default:return"scale"}return!1},_setupCurrentTransform:function(t,e,r){if(e){var i=this.getPointer(t),o=e._findTargetCorner(this.getPointer(t,!0)),s=this._getActionFromCorner(e,o,t),n=this._getOriginFromCorner(e,o);if("function"==typeof s){if(!r)return;s.call(this,t,e),s="void"}if(this._currentTransform={target:e,action:s,corner:o,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:n.x,originY:n.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,left:e.left,top:e.top,theta:h(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,originX:n.x,originY:n.y},"remove"===s){if(!r)return;this._removeAction(t,e)}if("moveUp"===s){if(!r)return;this._moveLayerUpAction(t,e)}if("moveDown"===s){if(!r)return;this._moveLayerDownAction(t,e)}if("object"==typeof s&&"rotateByDegrees"===Object.keys(s)[0]){if(!r)return;this._rotateByDegrees(t,e,s.rotateByDegrees)}this._resetCurrentTransform()}},_removeAction:function(t,e){var r=this;this.getActiveObjects()&&"undefined"!==this.getActiveObjects()?this.getActiveObjects().forEach(function(t){t.off(),r.discardActiveObject(),r.remove(t)}):(e.off(),this.discardActiveObject(),this.remove(e))},_moveLayerUpAction:function(t,e){this.getActiveObjects()&&"undefined"!==this.getActiveObjects()?this.getActiveObjects().forEach(function(t){t.bringForward()}):e.bringForward()},_moveLayerDownAction:function(t,e){this.getActiveObjects()&&"undefined"!==this.getActiveObjects()?this.getActiveObjects().forEach(function(t){t.sendBackwards()}):e.sendBackwards()},_rotateByDegrees:function(t,e,r){var i=parseInt(e.get("angle"))+r,o=!1;"center"===e.originX&&"center"===e.originY||!e.centeredRotation||(this._setOriginToCenter(e),o=!0),i=360<i?i-360:i,this.getActiveObjects()&&"undefined"!==this.getActiveObjects()?this.getActiveObjects().forEach(function(t){t.set("angle",i).setCoords()}):e.set("angle",i).setCoords(),o&&this._setCenterToOrigin(e),this.renderAll()},getCornerCursor:function(t,e,r){if(this.actionIsDisabled(t,e,r))return this.notAllowedCursor;if(this.fixedCursors&&this[t+"cursorIcon"])this[t+"cursorIcon"].match(/\.(?:jpe?g|png|gif|jpg|jpeg|svg)$/)?this.setCursor("url("+this[t+"cursorIcon"]+"), auto"):"resize"===this[t+"cursorIcon"]?this.setCursor(this._getRotatedCornerCursor(t,e,r)):this.setCursor(this[t+"cursorIcon"]);else if(t in i)this.setCursor(this._getRotatedCornerCursor(t,e,r));else{if("mtr"!==t||!e.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}return!1}}),"undefined"!=typeof exports&&(module.exports=this)}(window);